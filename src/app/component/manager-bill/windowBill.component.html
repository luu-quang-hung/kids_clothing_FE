<style>
    .row {
        margin: 10px 0px;
    }

    .row div {
        margin: 10px 0px;
    }

    label {
        display: block;
    }

    #loading {
        position: absolute !important;
        top: 0 !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        font-size: 64px !important;
        background-color: rgba(255, 255, 255, 0.3) !important;
        color: #ff6757 !important;
        z-index: 99999;
    }

    .k-content.k-window-content.k-dialog-content {
        width: 100% !important;
    }
</style>
<form [formGroup]="formGroup">
    <kendo-tabstrip>
        <kendo-tabstrip-tab title="Thông tin đơn hàng" [selected]="true">
            <ng-template kendoTabContent>
                <div *ngIf="api.loading" class="k-i-loading" id="loading"></div>
                <kendo-toolbar *ngIf="isToolbar">
                    <kendo-toolbar-button text="Hủy đơn" (click)="cancel()" *ngIf="isCancel"></kendo-toolbar-button>
                    <kendo-toolbar-button text="Xác nhận" (click)="confirm()" *ngIf="isConfirm"></kendo-toolbar-button>
                    <kendo-toolbar-button text="Giao bên vận chuyển" (click)="ship()" *ngIf="isShip">
                    </kendo-toolbar-button>
                    <kendo-toolbar-button text="Khách đã nhận hàng" (click)="received()" *ngIf="isReceived">
                    </kendo-toolbar-button>
                    <kendo-toolbar-button text="Hoàn hàng" (click)="refund()" *ngIf="isRefund"></kendo-toolbar-button>
                </kendo-toolbar>
                <div class="row">
                <div class="col-md-2" style="margin: 10px 0px;">
                    <label>Mã sản phẩm</label>
                    <input kendoTextBox readonly style="width: 100%;" formControlName="id"
                        [(ngModel)]="formGroup.value.id" />
                </div>
                <div class="col-md-2" style="margin: 10px 0px;">
                    <label>Phương thức thanh toán</label>
                    <div style="text-align: center;">
                        {{ formGroup.value.payment ? "Thanh toán bằng ví" : "Thanh toán bằng tiền mặt" }}
                    </div>
                </div>
                <div class="col-md-4" style="margin: 10px 0px;">
                    <label>Tên Người nhận</label>
                    <input kendoTextBox readonly formControlName="fullname" style="width: 100%;"
                        [(ngModel)]="formGroup.value.fullname" />
                </div>
                <div class="col-md-4" style="margin: 10px 0px;">
                    <label>SDT</label>
                    <input kendoTextBox readonly formControlName="sdt" style="width: 100%;"
                        [(ngModel)]="formGroup.value.sdt" />
                </div>
                <div class="col-md-4" style="margin: 10px 0px;">
                    <label>Trạng thái</label>
                    <input kendoTextBox readonly formControlName="status" style="width: 100%;"
                        [(ngModel)]="formGroup.value.status" />
                </div>
                <div class="col-md-4" style="margin: 10px 0px;">
                    <label>Tổng tiền (VND)</label>
                    <input kendoTextBox readonly formControlName="total" style="width: 100%;"
                    [ngModel]="formGroup.value.total | number:'1.0-0'" >
                </div>
                <div class="col-md-4" style="margin: 10px 0px;">
                    <label>Thanh toán (VND)</label>
                    <input kendoTextBox readonly formControlName="downtotal" style="width: 100%;"
                        [ngModel]="formGroup.value.downtotal | number:'1.0-0'" />
                </div>
                <div class="col-md-4" style="margin: 10px 0px;">
                    <label>Giá ship (VND)</label>
                    <input kendoTextBox readonly formControlName="transportFee" style="width: 100%;"
                        [ngModel]="formGroup.value.transportFee | number:'1.0-0'" />
                </div>
                <div class="col-md-8" style="margin: 10px 0px;">
                    <label>Địa chỉ</label>
                    <div class="input">
                      <input kendoTextBox  [readonly]="isAddressReadOnly" formControlName="address" style="width: 80%;"
                        [(ngModel)]="formGroup.value.address" />
                      <button class="update-button btn btn-primary"   (click)="saveAddress()">Cập nhật địa chỉ</button>
                    </div>
                  </div>
                    <div class="col-md-12" style="padding: 0px;">
                        <kendo-grid #grid [kendoGridBinding]="listOrderDetail" style="height: 400px; width: 1100;"
                            [pageSize]="20" [sortable]="true" [pageable]="true" [navigable]="true">
                            <kendo-grid-column field="productDetail.product.name" title="Tên sản phẩm" [width]="250">
                            </kendo-grid-column>

                                <kendo-grid-column field="quantitydetail" title="Số lượng" [width]="120">
                                    <ng-template kendoGridCellTemplate let-dataItem>
                                      <div class="quantity-input">
                                        <input type="number" value="{{dataItem.quantitydetail}}"  (change)="onQuantityChange(dataItem.id,$event)"  style="width: 50px;  border: none;
                                        outline: none;" />
                                      </div>
                                    </ng-template>
                                  </kendo-grid-column>
                            <kendo-grid-column field="productDetail.property.name" title="Thuộc tính" [width]="150">
                            </kendo-grid-column>
                            <kendo-grid-column field="productDetail.size.name" title="Size" [width]="150">
                            </kendo-grid-column>
                            <kendo-grid-column field="price" title="Giá gốc" [width]="150">
                                <ng-template kendoGridCellTemplate format="{0:n0}" let-dataItem>
                                    {{ dataItem.price |number :'1.0-3' }}
                                </ng-template>
                            </kendo-grid-column>
                            <kendo-grid-column field="downprice" title="Khuyến mại" [width]="150">
                                <ng-template kendoGridCellTemplate let-dataItem>
                                  {{ dataItem.downprice | number:'1.0-0' }}
                                </ng-template>
                              </kendo-grid-column>
                        </kendo-grid>
                    </div>
                </div>
            </ng-template>
        </kendo-tabstrip-tab>
        <kendo-tabstrip-tab title="Trạng thái vận chuyển">
            <ng-template kendoTabContent style="padding: 0px;">
                <kendo-listview [data]="listStatus" containerClass="k-d-flex k-flex-col k-flex-nowrap"
                    style="border: none;">
                    <ng-template kendoListViewItemTemplate let-dataItem="dataItem" let-index="index">
                        <div style="margin: 10px;border: 3px solid greenyellow;padding: 10px 15px;border-radius: 5px;
                        box-shadow: 2px #ddd;">
                            <p><strong>Thông tin: </strong>{{dataItem.content}}</p>
                            <p><strong>Ngày/giờ:</strong>
                                <kendo-datetimepicker [value]="getDate(dataItem.date)" [disabled]="true"
                                    style="margin: 0px 10px;"> </kendo-datetimepicker>
                            </p>
                        </div>
                    </ng-template>
                </kendo-listview>
            </ng-template>
        </kendo-tabstrip-tab>
    </kendo-tabstrip>
    <kendo-dialog *ngIf="opened" (close)="close('no')" title="Please confirm" [minWidth]="250" [width]="450">
        <div style="text-align: center;">
            <form [formGroup]="Reason">
                <div class="row" style="margin: 0px;">
                    <label class="col-md-3" style="margin: 20px 0px;">Trạng thái: </label>
                    <div class="col-md-9">
                        <kendo-dropdownlist [data]="statusRefund" textField="name" valueField="id" style="width: 100%;"
                            formControlName="status" (valueChange)="changeReasonStatus($event)">
                        </kendo-dropdownlist>
                    </div>
                </div>
                <div class="row" style="margin: 0px;">
                    <label class="col-md-3" style="margin: 10px 0px;">Lý do: </label>
                    <div class="col-md-9" style="margin: 0px;">
                        <kendo-textbox [disabled]="isDisabled" formControlName="note" style="width: 100%;"
                            [(ngModel)]="Reason.value.note"></kendo-textbox>
                    </div>
                </div>
            </form>
        </div>
        <kendo-dialog-actions>
            <div class="row" style="margin: 0px;">
                <div class="col-md-6">
                    <button kendoButton (click)="close('no')" style="width: 100%;">
                        Thoát
                    </button>
                </div>
                <div class="col-md-6">
                    <button kendoButton [primary]="true" (click)="close('yes')" style="width: 100%;">
                        Hoàn hàng
                    </button>
                </div>
            </div>
        </kendo-dialog-actions>
    </kendo-dialog>
</form>